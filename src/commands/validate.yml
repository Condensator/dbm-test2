description: >
  Ensure environment has DBmaestroAgent.jar
  If not - download it

parameters:
  tool_path:
    type: string
    default: "~/usr/local/tools/dbmaestro"
    description: "Path where the DBmaestroAgent.jar is located"
  project_name:
    type: string
    description: "DBmaestro project name"
  environment_name:
    type: string
    description: "DBmaestro environment name"
  package_name:
    type: string
    default: "@currentversion"
    description: "DBmaestro package name. By default runs validation against current version"
  server_address:
    type: string
    description: "DBmaestro server address"
  auth_type:
    type: string
    default: "DBmaestroAccount"
    description: "DBmaestro auth type"
  username:
    type: string
    description: "DBmaestro username"
  password:
    type: string
    description: "DBmaestro password"
steps:
  - run:
      environment:
        dbm_tool_path: << parameters.tool_path >>
        dbm_project_name: << parameters.project_name >>
        dbm_environment_name: << parameters.environment_name >>
        dbm_package_name: << parameters.package_name >>
        dbm_server_address: << parameters.server_address >>
        dbm_auth_type: << parameters.auth_type >>
        dbm_username: << parameters.username >>
        dbm_password: << parameters.password >>
      name: Validate environment
      command: java -jar "$DBM_TOOL_PATH/DBmaestroAgent.jar" -Validate -ProjectName "$DBM_PROJECT_NAME" -EnvName "$DBM_ENVIRONMENT_NAME" -PackageName "$DBM_PACKAGE_NAME" -Server "$DBM_SERVER_ADDRESS" -AuthType "$DBM_AUTH_TYPE" -UserName "$DBM_USERNAME" -Password "$DBM_PASSWORD"
